{"head":{"layout":"Post","title":"Integrating ReasonReact into your React app","route":"integrating-reason-react-into-your-react-app","date":"2018-12-09T07:00:00.000Z","tags":["reasonml","reason-react"],"description":"I recently gave a talk at a local meetup about integrating ReasonReact into your React app. While researching for the talk, I find out that…"},"body":"<p>I recently gave a talk at a local meetup about integrating ReasonReact into your React app. While researching for the talk, I find out that the resources for doing this is very limited so here we go.</p>\n<blockquote>\n<p>Please note that while this article shows you how to integrate ReasonReact into your existing React app, this works perfectly if you want to create new ReasonReact app with all bells and whistles.</p>\n</blockquote>\n<blockquote>\n<p>Also, this works for Parcel, your custom Webpack configuration or whatever build system you're using, as long as it knows how to package ES6 or commonjs module format.</p>\n</blockquote>\n<h1 id=\"tldr\"><a href=\"#tldr\" class=\"phenomic-HeadingAnchor\">#</a>TL;DR</h1>\n<p>Here is final code, you can clone and start coding right away:</p>\n<pre><code>git clone https://github.com/thangngoc89/reason-react-starter my-app\ncd my-app\nnpm install\n</code></pre>\n<p>Run <code>npm run start</code> and <code>npm run bsb:watch</code> in another tab</p>\n<h1 id=\"installations\"><a href=\"#installations\" class=\"phenomic-HeadingAnchor\">#</a>Installations</h1>\n<p>Let's assume that you are using <code>create-react-app</code> version 2 for building your app because it's extremely hard to correctly config webpack, babel, jest, eslint and makes them work well together. </p>\n<p>So here is the installation instructions of <code>create-react-app</code>:</p>\n<pre><code>npx create-react-app my-app\ncd my-app\n</code></pre>\n<p>For adding ReasonReact you would run this command:</p>\n<pre><code>npm install --save-dev bs-platform\nnpm install reason-react\n</code></pre>\n<blockquote>\n<p>Although the official guide recommend that you install bs-platform globally, I strongly disagree with that. Global installations are bad and it could lead to many weird behaviors.</p>\n</blockquote>\n<p>Next, you would make a file called <code>bsconfig.json</code> in the root of your project with this content:</p>\n<pre><code class=\"hljs language-js\">{\n  <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"my-app\"</span>,\n  <span class=\"hljs-string\">\"reason\"</span>: {\n    <span class=\"hljs-string\">\"react-jsx\"</span>: <span class=\"hljs-number\">2</span>\n  },\n  <span class=\"hljs-string\">\"sources\"</span>: [\n    {\n      <span class=\"hljs-string\">\"dir\"</span>: <span class=\"hljs-string\">\"src\"</span>,\n      <span class=\"hljs-string\">\"subdirs\"</span>: <span class=\"hljs-literal\">true</span>\n    }\n  ],\n  <span class=\"hljs-string\">\"package-specs\"</span>: [\n    {\n      <span class=\"hljs-string\">\"module\"</span>: <span class=\"hljs-string\">\"es6\"</span>,\n      <span class=\"hljs-string\">\"in-source\"</span>: <span class=\"hljs-literal\">true</span>\n    }\n  ],\n  <span class=\"hljs-string\">\"suffix\"</span>: <span class=\"hljs-string\">\".bs.js\"</span>,\n  <span class=\"hljs-string\">\"namespace\"</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-string\">\"bs-dependencies\"</span>: [\n    <span class=\"hljs-string\">\"reason-react\"</span>,\n  ],\n  <span class=\"hljs-string\">\"refmt\"</span>: <span class=\"hljs-number\">3</span>,\n}</code></pre>\n<p>Explaining the fields:</p>\n<ul>\n<li><code>name</code> this should be matched with your <code>package.json</code> <code>name</code> field</li>\n<li><code>react-jsx</code> this tells Bucklescript to use ReactJSX PPX version 2. I would suggest that you leave this as is.</li>\n<li><code>sources</code>: this tells Bucklescript where to look for the <code>*.re</code> files. You need to list all the directories that contains your source code here.</li>\n<li>\n<p><code>package-specs</code>: </p>\n<ul>\n<li><code>module</code>: could be <code>es6</code> or <code>commonjs</code>. <code>create-react-app</code> uses ES6 by default.</li>\n<li><code>in-source</code>: with this option turned on, Bucklescript will output a file right next to your <code>.re</code> file. This helps tremendously with require paths.</li>\n</ul>\n</li>\n<li><code>suffix</code>: could be <code>.bs.js</code> or <code>.js</code>. This is the suffix of the generated files. </li>\n</ul>\n<p>For more information about <code>bsconfig.json</code>, you can refer to its JSON API </p>\n<p><a href=\"https://bucklescript.github.io/bucklescript/docson/#https://bucklescript.github.io/bucklescript/docson/build-schema.json\">https://bucklescript.github.io/bucklescript/docson/#https://bucklescript.github.io/bucklescript/docson/build-schema.json</a></p>\n<p>So our plan is that Bucklescript output <code>.js</code> files and your current build system would pick it up and do its job. </p>\n<p>You should add these command to the <code>scripts</code> section in <code>package.json</code>:</p>\n<pre><code>\"scripts: {\n  ...\n  \"bsb\": \"bsb -make-world\",\n  \"bsb:watch\": \"bsb -make-world -w\",\n  \"bsb:clean\": \"bsb -clean-world\"\n}\n</code></pre>\n<p>Now you can run <code>npm run bsb:watch</code> and <code>npm start</code> in another tab and making your awesome app with ReasonReact.</p>\n<blockquote>\n<p>You can use <a href=\"https://evilmartians.com/chronicles/introducing-overmind-and-hivemind\">Overmind</a> for keeping all the command in a single terminal tab. Or <a href=\"https://github.com/tmux/tmux\">tmux</a> for easily managing multiple terminal tabs.</p>\n</blockquote>\n<h1 id=\"usages\"><a href=\"#usages\" class=\"phenomic-HeadingAnchor\">#</a>Usages</h1>\n<p>So this is the content inside <code>src</code> directory right now:</p>\n<pre><code>src\n├── App.css\n├── App.js\n├── App.test.js\n├── index.css\n├── index.js\n├── logo.svg\n└── serviceWorker.js\n</code></pre>\n<p>Let's go ahead and create a new file called <code>Greetings.re</code>:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">let</span> <span class=\"hljs-attr\">component</span> = ReasonReact.statelessComponent(<span class=\"hljs-string\">\"Greetings\"</span>);\n\n<span class=\"hljs-keyword\">let</span> <span class=\"hljs-attr\">make</span> = (~message, _children) => {\n  ...component,\n  render: <span class=\"hljs-attr\">_self</span> => {\n    &#x3C;p> {ReasonReact.string(<span class=\"hljs-string\">\"Message from ReasonReact \"</span> ++ message)} &#x3C;/p>;\n  },\n};</code></pre>\n<p>With <code>bsb</code> watcher running in the background, you'll see that a new file called <code>Greetings.bs.js</code> was created inside <code>src</code> folder. This is what the <code>in-source</code> option in <code>bsconfig.json</code> does. </p>\n<p>If you want to use <code>Greetings</code> inside the rest of your React app, you have to export it first with <a href=\"https://reasonml.github.io/reason-react/docs/en/interop#reactjs-using-reasonreact\"><code>wrapReasonForJs</code></a> because ReasonReact and React components aren't compaitable:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">let</span> component = <span class=\"hljs-type\">ReasonReact</span>.statelessComponent(<span class=\"hljs-string\">\"Greetings\"</span>);\n\n<span class=\"hljs-keyword\">let</span> make = (~message, _children) => {\n  ...component,\n  render: _self => {\n    &#x3C;p> {<span class=\"hljs-type\">ReasonReact</span>.<span class=\"hljs-built_in\">string</span>(<span class=\"hljs-string\">\"Message from ReasonReact \"</span> ++ message)} &#x3C;/p>;\n  },\n};\n\n[@bs.deriving abstract]\n<span class=\"hljs-keyword\">type</span> jsProps = {\n  message: <span class=\"hljs-built_in\">string</span>,\n  children: <span class=\"hljs-built_in\">array</span>(<span class=\"hljs-type\">ReasonReact</span>.reactElement),\n};\n\n<span class=\"hljs-keyword\">let</span> default =\n  <span class=\"hljs-type\">ReasonReact</span>.wrapReasonForJs(~component, jsProps =>\n    make(~message=jsProps->messageGet, jsProps->childrenGet)\n  );</code></pre>\n<blockquote>\n<p>Tips: You can automatically generate <code>wrapReasonForJs</code> with a tool called <a href=\"https://github.com/cristianoc/genType\">genType</a></p>\n</blockquote>\n<p>Now, you can use Greetings inside <code>App.js</code>:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> React, { Component } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"react\"</span>;\n<span class=\"hljs-keyword\">import</span> logo <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"./logo.svg\"</span>;\n<span class=\"hljs-keyword\">import</span> Greetings <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"./Greetings.bs\"</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">\"./App.css\"</span>;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">App</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  render() {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"App\"</span>></span>\n        </span>&#x3C;Greetings message=\"Hello World\" />\n        &#x3C;header className=\"App-header\">\n          &#x3C;img src={logo} className=\"App-logo\" alt=\"logo\" />\n          &#x3C;p>\n            Edit &#x3C;code>src/App.js&#x3C;/code> and save to reload.\n          &#x3C;/p>\n          &#x3C;a\n            className=\"App-link\"\n            href=\"https://reactjs.org\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Learn React\n          &#x3C;/a>\n        &#x3C;/header>\n      &#x3C;/div>\n    );\n  }\n}\n\nexport default App;</code></pre>\n<p>That's it guys. Happy coding!</p>\n","__filename":"integrating-reason-react-into-your-react-app/index.md","__url":"/integrating-reason-react-into-your-react-app/","__resourceUrl":"/integrating-reason-react-into-your-react-app/index.html","__dataUrl":"/integrating-reason-react-into-your-react-app/index.html.ce231475354cc0d22a04725f660f8fb7.json"}